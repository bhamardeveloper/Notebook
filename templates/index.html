<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Notes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container py-5">
        <h1 class="text-center mb-4">üìù My Notes</h1>

        <!-- Add note form  -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <form id="noteForm">
                    <div class="mb-3">
                        <input type="text" id="title" class="form-control" placeholder="Title" required>
                    </div>
                    <div class="mb-3">
                        <textarea id="content" class="form-control" placeholder="Content" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Note</button>
                </form>
            </div>
        </div>

        <!-- Notes List -->
        <ul id="notesList" class="list-group shadow-sm"></ul>
    </div>

    <script>
        const notesList = document.getElementById('notesList');
        const form = document.getElementById('noteForm');

        // Load all notes
        async function loadNotes() {
            const res = await fetch('/api/notes');
            const notes = await res.json();
            notesList.innerHTML = "";
            notes.forEach(note => {
                const li = document.createElement('li');
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.innerHTML = `
                    <div>
                        <strong>${note.title}</strong><br>
                        <small class="text-muted">${note.content}</small>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-warning me-2" onclick="editNote(${note.id}, '${note.title}', '${note.content}')">Edit</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteNote(${note.id})">Delete</button>
                    </div>
                `;
                notesList.appendChild(li);
            });
        }

        // Add new note
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            await fetch('/api/notes', {
                method: 'POST',
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, content })
            });
            form.reset();
            loadNotes();
        });

        // Delete note
        async function deleteNote(id) {
            await fetch(`/api/notes/${id}`, { method: 'DELETE' });
            loadNotes();  
        }

        // Edit note
        async function editNote(id, oldTitle, oldContent) {
            const li = [...notesList.children].find(item =>
                item.innerHTML.includes(`editNote(${id},`)
            );

            if (!li) return;

            li.innerHTML = `
        <form onsubmit="saveEdit(event, ${id})" class="d-flex justify-content-between align-items-center w-100">
            <div>
            <input type="text" id="edit-title-${id}" class="form-control mb-1" value="${oldTitle}" required>
            <textarea id="edit-content-${id}" class="form-control" required>${oldContent}</textarea>
            </div>
            <div>
                <button type="submit" class="btn btn-sm btn-success me-2">Save</button>
                <button type="button" class="btn btn-sm btn-secondary" onclick="cancelEdit(${id}, '${oldTitle}', '${oldContent}')">Cancel</button>
            </div>
        </form>
    `;
        }

        async function saveEdit(event, id) {
            event.preventDefault();
            const newTitle = document.getElementById(`edit-title-${id}`).value;
            const newContent = document.getElementById(`edit-content-${id}`).value;

            await fetch(`/api/notes/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title: newTitle, content: newContent })
            });

            loadNotes();
        }

        function cancelEdit(id, oldTitle, oldContent) {
            loadNotes(); // Just reload all notes back
        }



        // Initial load
        loadNotes();
    </script>
</body>

</html>